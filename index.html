<!DOCTYPE html>
<html>
	<head>
		<title>PTT</title>
		<script src="Task.js"></script>
		<script src="Database.js"></script>
		<script>
			/**
			* Global array containing all jobs
			*/
			var jobs = [];
		
			/**
			* Format Date object to display the time properly
			*/
			function formatTime(tps) {
				var h = tps.getHours();
				var m = tps.getMinutes();
				var s = tps.getSeconds();
				return ((h>9)?"":"0")+h+":"+((m>9)?"":"0")+m+":"+((s>9)?"":"0")+s;
			}
			
			/**
			* Auto updated current Time display
			*/
			function showTime(){
				document.querySelector("#time").innerHTML = formatTime(new Date());
				setTimeout(showTime,1000);
			}
			
			/**
			* init
			*/
			document.addEventListener("DOMContentLoaded", showTime, false);
			document.addEventListener("DOMContentLoaded", function(){
				document.querySelector("#control #start").addEventListener("click", function(e){
					//pause currently running task
					if (jobs.length > 0) jobs[jobs.length-1].pause();
					// start a new task
					jobs.push(new Task());
					document.querySelector("#jobs").appendChild(jobs[jobs.length-1].getHTML());
				}, false);
				
				document.querySelector("#control #stop").addEventListener("click", function(e){
					//pause currently running task
					if (jobs.length > 0) jobs[jobs.length-1].pause();
				}, false);
			}, false);
			
			if ('openDatabase' in window){
				document.addEventListener("DOMContentLoaded", function(){
					
					Database.init();
					
					Database.load(function(task){
						jobs.push(new Task(task.start,task.project,task.desc,task.duration));
						jobs[jobs.length-1].id = task.id;
						document.querySelector("#jobs").appendChild(jobs[jobs.length-1].getHTML());
					});
					
					document.querySelector("#reset").addEventListener("click", function(e){
						Database.erase();
					});
				});
			}
		</script>
		<style>
			#time { font-family: Helvetica; font-size: 70px; margin: auto; width: 270px;}
			.timer{background-color: blue; display: inline-block; height: 12pt; margin:0 5px}
			.startTime{font-weight:bold}
			.job input{border:none; margin: 0 1ex; width:0ex;}
		</style>
	</head>
	<body>
		<div id="time">0:00:00</div>
		<input id="reset" type="button" value="reset">
		<div id="jobs">
			<form id="control">
				<input id="start" type="button" value="start">
				<input id="stop" type="button" value="stop">
			</form>
		</div>
	</body>
</html>
